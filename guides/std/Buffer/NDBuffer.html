<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="alternate" type="application/atom+xml" href="https://www.mojodojo.dev/atom.xml" title="Mojo Dojo Atom Feed"><link rel="alternate" type="application/json" href="https://www.mojodojo.dev/feed.json" title="Mojo Dojo JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://www.mojodojo.dev/rss.xml" title="Mojo Dojo RSS Feed"><title>NDBuffer | Mojo Dojo</title><meta name="description" content="Learning Resources for Mojo ðŸ”¥">
    <link rel="preload" href="/assets/style-DX9J1ZAv.css" as="style"><link rel="stylesheet" href="/assets/style-DX9J1ZAv.css">
    <link rel="modulepreload" href="/assets/app-P3E1jSxo.js"><link rel="modulepreload" href="/assets/NDBuffer.html-BW623zdb.js">
    <link rel="prefetch" href="/assets/definitions.html-C8gF9Xb0.js" as="script"><link rel="prefetch" href="/assets/index.html-B1GyxrCZ.js" as="script"><link rel="prefetch" href="/assets/is-mojo-for-me.html-BJIpjXO8.js" as="script"><link rel="prefetch" href="/assets/mojo-team-answers.html-DzsRhGvU.js" as="script"><link rel="prefetch" href="/assets/2023-05-08-why-use-mojo.html-CQMe2oen.js" as="script"><link rel="prefetch" href="/assets/2023-05-22-mojo-first-impressions.html-GoamWJ0D.js" as="script"><link rel="prefetch" href="/assets/2023-07-17-rust-or-mojo-ai.html-D7o_m651.js" as="script"><link rel="prefetch" href="/assets/index.html-D0rV02ex.js" as="script"><link rel="prefetch" href="/assets/index.html-C4Ox_euk.js" as="script"><link rel="prefetch" href="/assets/31.html-DXI59mvE.js" as="script"><link rel="prefetch" href="/assets/index.html-C5SLCKkO.js" as="script"><link rel="prefetch" href="/assets/2023-05-12.html-BHl49_VQ.js" as="script"><link rel="prefetch" href="/assets/2023-05-19.html-BiiESobv.js" as="script"><link rel="prefetch" href="/assets/2023-05-26.html-NFtGtWRt.js" as="script"><link rel="prefetch" href="/assets/2023-06-02.html-Zo2qcPuW.js" as="script"><link rel="prefetch" href="/assets/2023-06-09.html-CFClbV00.js" as="script"><link rel="prefetch" href="/assets/2023-06-16.html-DXsGmkw1.js" as="script"><link rel="prefetch" href="/assets/2023-06-23.html-C9DlGGbr.js" as="script"><link rel="prefetch" href="/assets/2023-06-30.html-Dq2-n6z9.js" as="script"><link rel="prefetch" href="/assets/2023-07-07.html-B-KPskAI.js" as="script"><link rel="prefetch" href="/assets/2023-07-14.html-BEnmDPXU.js" as="script"><link rel="prefetch" href="/assets/2023-07-21.html-CTk-fQI6.js" as="script"><link rel="prefetch" href="/assets/2023-07-28.html-ClTsFpuO.js" as="script"><link rel="prefetch" href="/assets/2023-08-04.html-Cw7KI_gZ.js" as="script"><link rel="prefetch" href="/assets/2023-08-11.html-BCPRp2ym.js" as="script"><link rel="prefetch" href="/assets/2023-08-18.html-Bi1wXmep.js" as="script"><link rel="prefetch" href="/assets/2024-08-24-issue-31.html-C69VRCS-.js" as="script"><link rel="prefetch" href="/assets/index.html-5D9477Uj.js" as="script"><link rel="prefetch" href="/assets/mojo-team-answers.html-D4W4BMdC.js" as="script"><link rel="prefetch" href="/assets/sudoku.html-BTzpyEkS.js" as="script"><link rel="prefetch" href="/assets/Bool.html-DuE3PkVF.js" as="script"><link rel="prefetch" href="/assets/BuiltinList.html-r5sFzFIZ.js" as="script"><link rel="prefetch" href="/assets/BuiltinSlice.html-an_peQpd.js" as="script"><link rel="prefetch" href="/assets/Error.html-ClrE-fpC.js" as="script"><link rel="prefetch" href="/assets/FloatLiteral.html-DvVgFV-T.js" as="script"><link rel="prefetch" href="/assets/StringLiteral.html-ShRULUzH.js" as="script"><link rel="prefetch" href="/assets/StringRef.html-B21xGqRs.js" as="script"><link rel="prefetch" href="/assets/Tuple.html-G-7-uyaw.js" as="script"><link rel="prefetch" href="/assets/always_inline.html-cxNArhmc.js" as="script"><link rel="prefetch" href="/assets/noncapturing.html-Cx5BQM2b.js" as="script"><link rel="prefetch" href="/assets/parameter.html-B_9ykDpH.js" as="script"><link rel="prefetch" href="/assets/register_passable.html-Cxv-CmUS.js" as="script"><link rel="prefetch" href="/assets/value.html-i58SgqfS.js" as="script"><link rel="prefetch" href="/assets/assert.html-OKfGBR5e.js" as="script"><link rel="prefetch" href="/assets/opencv.html-BrmErEHP.js" as="script"><link rel="prefetch" href="/assets/basic-types.html-DhSRu0rJ.js" as="script"><link rel="prefetch" href="/assets/Assert.html-CyXAAvXb.js" as="script"><link rel="prefetch" href="/assets/Benchmark.html-DZ0pbKGE.js" as="script"><link rel="prefetch" href="/assets/Random.html-DL-3r-_Z.js" as="script"><link rel="prefetch" href="/assets/Sort.html-Peji4XnO.js" as="script"><link rel="prefetch" href="/assets/String.html-DXxnGyov.js" as="script"><link rel="prefetch" href="/assets/TargetInfo.html-DapV76O4.js" as="script"><link rel="prefetch" href="/assets/Time.html-CAZ6H0_3.js" as="script"><link rel="prefetch" href="/assets/Buffer.html-nRZMcYEo.js" as="script"><link rel="prefetch" href="/assets/DTypePointer.html-BT8wRl5T.js" as="script"><link rel="prefetch" href="/assets/Pointer.html-D90_CPPb.js" as="script"><link rel="prefetch" href="/assets/DynamicVector.html-BtsF4TWv.js" as="script"><link rel="prefetch" href="/assets/InlinedFixedVector.html-DEXAeoox.js" as="script"><link rel="prefetch" href="/assets/UnsafeFixedVector.html-Ckjp_voc.js" as="script"><link rel="prefetch" href="/assets/404.html-D84_9zrf.js" as="script"><link rel="prefetch" href="/assets/giscus-7BMGhbDA.js" as="script"><link rel="prefetch" href="/assets/style-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/assets/docsearch-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/assets/index-Ds2TtRM5.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="logo" src="/hero.png" alt="Mojo Dojo"><span class="site-name can-hide" aria-hidden="true">Mojo Dojo</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link route-link-active" href="/guides/" aria-label="Guides"><!--[--><!--[--><!--]--> Guides <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/mojo-team-answers.html" aria-label="Mojo Team Answers"><!--[--><!--[--><!--]--> Mojo Team Answers <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/this-week-in-mojo/" aria-label="This Week in Mojo"><!--[--><!--[--><!--]--> This Week in Mojo <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/" aria-label="Blog"><!--[--><!--[--><!--]--> Blog <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/is-mojo-for-me.html" aria-label="Is Mojo for Me?"><!--[--><!--[--><!--]--> Is Mojo for Me? <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/modularml/mojodojo.dev" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link route-link-active" href="/guides/" aria-label="Guides"><!--[--><!--[--><!--]--> Guides <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/mojo-team-answers.html" aria-label="Mojo Team Answers"><!--[--><!--[--><!--]--> Mojo Team Answers <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/this-week-in-mojo/" aria-label="This Week in Mojo"><!--[--><!--[--><!--]--> This Week in Mojo <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/" aria-label="Blog"><!--[--><!--[--><!--]--> Blog <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/is-mojo-for-me.html" aria-label="Is Mojo for Me?"><!--[--><!--[--><!--]--> Is Mojo for Me? <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/modularml/mojodojo.dev" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a class="route-link route-link-active sidebar-item sidebar-heading collapsible" href="/guides/" aria-label="Guides"><!--[--><!--[--><!--]--> Guides <!--[--><!--]--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">Intro to Mojo <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/guides/intro-to-mojo/basic-types.html" aria-label="Basic Types"><!--[--><!--[--><!--]--> Basic Types <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link sidebar-item sidebar-heading" href="/mojo-team-answers.html" aria-label="Mojo Team Answers"><!--[--><!--[--><!--]--> Mojo Team Answers <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item sidebar-heading collapsible" href="/this-week-in-mojo/" aria-label="This Week in Mojo"><!--[--><!--[--><!--]--> This Week in Mojo <!--[--><!--]--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-08-18.html" aria-label="This Week in Mojo 2023-08-18"><!--[--><!--[--><!--]--> This Week in Mojo 2023-08-18 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-08-11.html" aria-label="This Week in Mojo 2023-08-11"><!--[--><!--[--><!--]--> This Week in Mojo 2023-08-11 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-08-04.html" aria-label="This Week in Mojo 2023-08-04"><!--[--><!--[--><!--]--> This Week in Mojo 2023-08-04 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-07-28.html" aria-label="This Week in Mojo 2023-07-28"><!--[--><!--[--><!--]--> This Week in Mojo 2023-07-28 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-07-21.html" aria-label="This Week in Mojo 2023-07-21"><!--[--><!--[--><!--]--> This Week in Mojo 2023-07-21 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-07-14.html" aria-label="This Week in Mojo 2023-07-14"><!--[--><!--[--><!--]--> This Week in Mojo 2023-07-14 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-07-07.html" aria-label="This Week in Mojo 2023-07-07"><!--[--><!--[--><!--]--> This Week in Mojo 2023-07-07 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-06-30.html" aria-label="This Week in Mojo 2023-06-30"><!--[--><!--[--><!--]--> This Week in Mojo 2023-06-30 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-06-23.html" aria-label="This Week in Mojo 2023-06-23"><!--[--><!--[--><!--]--> This Week in Mojo 2023-06-23 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-06-16.html" aria-label="This Week in Mojo 2023-06-16"><!--[--><!--[--><!--]--> This Week in Mojo 2023-06-16 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-06-09.html" aria-label="This Week in Mojo 2023-06-09"><!--[--><!--[--><!--]--> This Week in Mojo 2023-06-09 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-06-02.html" aria-label="This Week in Mojo 2023-06-02"><!--[--><!--[--><!--]--> This Week in Mojo 2023-06-02 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-05-26.html" aria-label="This Week in Mojo 2023-05-26"><!--[--><!--[--><!--]--> This Week in Mojo 2023-05-26 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-05-19.html" aria-label="This Week in Mojo 2023-05-19"><!--[--><!--[--><!--]--> This Week in Mojo 2023-05-19 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/this-week-in-mojo/2023-05-12.html" aria-label="This Week in Mojo 2023-05-12"><!--[--><!--[--><!--]--> This Week in Mojo 2023-05-12 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item sidebar-heading collapsible" href="/modverse-weekly/" aria-label="Modverse Weekly"><!--[--><!--[--><!--]--> Modverse Weekly <!--[--><!--]--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/modverse-weekly/issue-31.html" aria-label="/modverse-weekly/issue-31.html"><!--[--><!--[--><!--]--> /modverse-weekly/issue-31.html <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item sidebar-heading collapsible" href="/blog/" aria-label="Blog"><!--[--><!--[--><!--]--> Blog <!--[--><!--]--><!--]--></a><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/blog/2023-07-17-rust-or-mojo-ai.html" aria-label="Rust or Mojo for the future of AI?"><!--[--><!--[--><!--]--> Rust or Mojo for the future of AI? <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/2023-05-22-mojo-first-impressions.html" aria-label="Mojo First Impressions"><!--[--><!--[--><!--]--> Mojo First Impressions <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/2023-05-08-why-use-mojo.html" aria-label="Why Use Mojo?"><!--[--><!--[--><!--]--> Why Use Mojo? <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item sidebar-heading" href="/is-mojo-for-me.html" aria-label="Is Mojo for me?"><!--[--><!--[--><!--]--> Is Mojo for me? <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ndbuffer" tabindex="-1"><a class="header-anchor" href="#ndbuffer"><span>NDBuffer</span></a></h1><p>A buffer that doesn&#39;t own the underlying memory, it allows you to represent an N-Dimensional shape both statically, and dynamically at runtime</p><h2 id="import" tabindex="-1"><a class="header-anchor" href="#import"><span>import</span></a></h2><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> DType </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> DType</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> List </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> DimList</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> Pointer </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> DTypePointer</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> Buffer </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> NDBuffer</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> Memory </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> memset_zero</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> List </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> VariadicList</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> DimList</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> Assert </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> assert_param</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> Functional </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> unroll</span></span>
<span class="line"><span style="color:#7DCFFF;">from</span><span style="color:#A9B1D6;"> Index </span><span style="color:#7DCFFF;">import</span><span style="color:#A9B1D6;"> StaticIntTuple</span></span>
<span class="line"></span></code></pre></div><h2 id="setup" tabindex="-1"><a class="header-anchor" href="#setup"><span>setup</span></a></h2><p>This struct allows you to carry around the pointer that owns the data the NDBuffer is pointing to.</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#BB9AF7;">struct</span><span style="color:#A9B1D6;"> Tensor</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DimList</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DType</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> buffer</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> NDBuffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#0DB9D7;"> __init__</span><span style="color:#9ABDF5;">(</span><span style="color:#9D7CD8;font-style:italic;">inout</span><span style="color:#E0AF68;"> self</span><span style="color:#9ABDF5;">):</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">        let</span><span style="color:#C0CAF5;"> size</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">product</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#9ABDF5;">]()</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">alloc</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">size</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#7AA2F7;">        memset_zero</span><span style="color:#9ABDF5;">(</span><span style="color:#F7768E;">self</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">data</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> size</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> NDBuffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#9ABDF5;">](</span><span style="color:#F7768E;">self</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">data</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#0DB9D7;"> __del__</span><span style="color:#9ABDF5;">(</span><span style="color:#9D7CD8;font-style:italic;">owned</span><span style="color:#E0AF68;"> self</span><span style="color:#9ABDF5;">):</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">free</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"></span></code></pre></div><h2 id="init" tabindex="-1"><a class="header-anchor" href="#init"><span>init</span></a></h2><p>We can now create a shape statically and store data, but be careful there&#39;s no safety checks on our struct yet:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#9D7CD8;font-style:italic;">let</span><span style="color:#C0CAF5;"> x</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> Tensor</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">3</span><span style="color:#89DDFF;">,</span><span style="color:#7AA2F7;"> DimList</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint8</span><span style="color:#9ABDF5;">]()</span></span>
<span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">simd_store</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#C0CAF5;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">uint8</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 3</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 4</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 5</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 6</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 7</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><p>Let&#39;s try using the buffer now:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">num_elements</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>8
</code></pre><h2 id="indexing" tabindex="-1"><a class="header-anchor" href="#indexing"><span>indexing</span></a></h2><p>We can also access elements via it&#39;s 3D shape:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>1
</code></pre><p>Notice incrementing the first dimension will get the 5th item:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>5
</code></pre><p>And incrementing the 2nd dimension will increment get the 7th:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>7
</code></pre><p>To set an item we need to use a <code>StaticIntTuple</code></p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">StaticIntTuple</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">3</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">)]</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 50</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>50
</code></pre><h2 id="runtime-bounds-checking" tabindex="-1"><a class="header-anchor" href="#runtime-bounds-checking"><span>runtime bounds checking</span></a></h2><p>There are no safety checks on our struct yet so we can access data out of bounds:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>0
</code></pre><p>This is a big safety concern so let&#39;s make our own <code>__get__</code> method that enforces bounds checking:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#BB9AF7;">struct</span><span style="color:#A9B1D6;"> Tensor</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DimList</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DType</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> buffer</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> NDBuffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#0DB9D7;"> __init__</span><span style="color:#9ABDF5;">(</span><span style="color:#9D7CD8;font-style:italic;">inout</span><span style="color:#E0AF68;"> self</span><span style="color:#9ABDF5;">):</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">        let</span><span style="color:#C0CAF5;"> size</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">product</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#9ABDF5;">]()</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">alloc</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">size</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#7AA2F7;">        memset_zero</span><span style="color:#9ABDF5;">(</span><span style="color:#F7768E;">self</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">data</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> size</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> NDBuffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#9ABDF5;">](</span><span style="color:#F7768E;">self</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">data</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#0DB9D7;"> __del__</span><span style="color:#9ABDF5;">(</span><span style="color:#9D7CD8;font-style:italic;">owned</span><span style="color:#E0AF68;"> self</span><span style="color:#9ABDF5;">):</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">free</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#0DB9D7;"> __getitem__</span><span style="color:#9ABDF5;">(</span><span style="color:#E0AF68;">self</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> *</span><span style="color:#E0AF68;">idx</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">)</span><span style="color:#9D7CD8;font-style:italic;"> raises</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">]:</span></span>
<span class="line"><span style="color:#BB9AF7;">        for</span><span style="color:#A9B1D6;"> i </span><span style="color:#BB9AF7;">in</span><span style="color:#0DB9D7;"> range</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">rank</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BB9AF7;">            if</span><span style="color:#A9B1D6;"> idx</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">i</span><span style="color:#9ABDF5;">]</span><span style="color:#BB9AF7;"> &gt;=</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">value</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">i</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get</span><span style="color:#9ABDF5;">()</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BB9AF7;">                raise</span><span style="color:#7AA2F7;"> Error</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">index out of bounds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#BB9AF7;">        return</span><span style="color:#F7768E;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">VariadicList</span><span style="color:#9ABDF5;">[</span><span style="color:#7AA2F7;">Int</span><span style="color:#9ABDF5;">](</span><span style="color:#C0CAF5;">idx</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#9D7CD8;font-style:italic;">let</span><span style="color:#C0CAF5;"> x</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> Tensor</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">3</span><span style="color:#89DDFF;">,</span><span style="color:#7AA2F7;"> DimList</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint64</span><span style="color:#9ABDF5;">]()</span></span>
<span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">simd_store</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#C0CAF5;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">uint64</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 3</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 4</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 5</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 6</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 7</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>Error: index out of bounds
</code></pre><h2 id="compile-time-bounds-checking" tabindex="-1"><a class="header-anchor" href="#compile-time-bounds-checking"><span>compile time bounds checking</span></a></h2><p>This bounds checking isn&#39;t optimal because it has a runtime cost, we could create a separate function that checks the shape at compile time:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#BB9AF7;">struct</span><span style="color:#A9B1D6;"> Tensor</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DimList</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DType</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    var</span><span style="color:#C0CAF5;"> buffer</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> NDBuffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#0DB9D7;"> __init__</span><span style="color:#9ABDF5;">(</span><span style="color:#9D7CD8;font-style:italic;">inout</span><span style="color:#E0AF68;"> self</span><span style="color:#9ABDF5;">):</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">        let</span><span style="color:#C0CAF5;"> size</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">product</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#9ABDF5;">]()</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> DTypePointer</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">alloc</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">size</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#7AA2F7;">        memset_zero</span><span style="color:#9ABDF5;">(</span><span style="color:#F7768E;">self</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">data</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> size</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#F7768E;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A9B1D6;"> NDBuffer</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> type</span><span style="color:#9ABDF5;">](</span><span style="color:#F7768E;">self</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">data</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BB9AF7;">    fn</span><span style="color:#7AA2F7;"> get</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">*</span><span style="color:#E0AF68;">idx</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">](</span><span style="color:#E0AF68;">self</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;"> -&gt;</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#0DB9D7;">type</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">]:</span></span>
<span class="line"><span style="color:#89DDFF;">        @</span><span style="color:#7AA2F7;">parameter</span></span>
<span class="line"><span style="color:#BB9AF7;">        fn</span><span style="color:#7AA2F7;"> check_dim</span><span style="color:#9ABDF5;">[</span><span style="color:#E0AF68;">i</span><span style="color:#89DDFF;">:</span><span style="color:#A9B1D6;"> Int</span><span style="color:#9ABDF5;">]():</span></span>
<span class="line"><span style="color:#A9B1D6;">            assert_param</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">idx</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">i</span><span style="color:#9ABDF5;">]</span><span style="color:#BB9AF7;"> &lt;</span><span style="color:#A9B1D6;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">value</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">i</span><span style="color:#9ABDF5;">]</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get</span><span style="color:#9ABDF5;">()]()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A9B1D6;">        unroll</span><span style="color:#9ABDF5;">[</span><span style="color:#A9B1D6;">rank</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> check_dim</span><span style="color:#9ABDF5;">]()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BB9AF7;">        return</span><span style="color:#F7768E;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#9ABDF5;">](</span><span style="color:#7AA2F7;">VariadicList</span><span style="color:#9ABDF5;">[</span><span style="color:#7AA2F7;">Int</span><span style="color:#9ABDF5;">](</span><span style="color:#C0CAF5;">idx</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><p><code>*idx</code> is a variadic list of <code>Int</code>, so you can pass in as many as you like.</p><p><code>get()</code> Creates a closure named <code>check_dim</code> decorated by <code>@parameter</code> so it runs at compile time, it&#39;s checking that each item in <code>*idx</code> is less then the same dimension in the static <code>shape</code>. <code>unroll</code> is used to run it at compile-time <code>i</code> amount of times.</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#9D7CD8;font-style:italic;">let</span><span style="color:#C0CAF5;"> x</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> Tensor</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">3</span><span style="color:#89DDFF;">,</span><span style="color:#7AA2F7;"> DimList</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A9B1D6;"> DType</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">uint64</span><span style="color:#9ABDF5;">]()</span></span>
<span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">data</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">simd_store</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> SIMD</span><span style="color:#9ABDF5;">[</span><span style="color:#C0CAF5;">DType</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">uint64</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 3</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 4</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 5</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 6</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 7</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">get</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 2</span><span style="color:#9ABDF5;">]())</span></span>
<span class="line"></span></code></pre></div><pre><code>Expression [12]:17:56:                             constraint failed: param assertion failed
            assert_param[idx[i] &lt; shape.value[i].get()]()
                                                       ^

expression failed to parse (no further compiler diagnostics)
</code></pre><h2 id="simd-load" tabindex="-1"><a class="header-anchor" href="#simd-load"><span>simd_load</span></a></h2><p>Loads SIMD values from the specified position, e.g.:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">4</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">4</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">2</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><pre><code>[0, 1, 2, 3]
[4, 5, 6, 7]
[6, 7]
</code></pre><h2 id="simd-store" tabindex="-1"><a class="header-anchor" href="#simd-store"><span>simd_store</span></a></h2><p>Store a SIMD vector at the given ND index, for example here we take the first 4 numbers, multiply them by 8, and store them in the second half of the tensor.</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">simd_store</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">StaticIntTuple</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">3</span><span style="color:#9ABDF5;">](</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">,</span><span style="color:#C0CAF5;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">4</span><span style="color:#9ABDF5;">]()</span><span style="color:#89DDFF;"> *</span><span style="color:#FF9E64;"> 8</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">simd_load</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">8</span><span style="color:#9ABDF5;">]())</span></span>
<span class="line"></span></code></pre></div><pre><code>[0, 1, 2, 3, 0, 8, 16, 24]
</code></pre><h2 id="fields" tabindex="-1"><a class="header-anchor" href="#fields"><span>Fields</span></a></h2><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">dynamic_dtype</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">dynamic_shape</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">dynamic_stride</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">is_contiguous</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"></span></code></pre></div><pre><code>uint64
(2, 2, 2)
(4, 2, 1)
True
</code></pre><h2 id="bytecount" tabindex="-1"><a class="header-anchor" href="#bytecount"><span>bytecount</span></a></h2><p>The total amount of bytes in the buffer</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">bytecount</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>64
</code></pre><h2 id="dim" tabindex="-1"><a class="header-anchor" href="#dim"><span>dim</span></a></h2><p>The dimension at the given index</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">dim</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#9ABDF5;">]())</span></span>
<span class="line"></span></code></pre></div><pre><code>2
</code></pre><h2 id="fill" tabindex="-1"><a class="header-anchor" href="#fill"><span>fill</span></a></h2><p>Fills the buffer in chunks of you SIMD register size, but doesn&#39;t go out of bounds</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">fill</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">10</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 1</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>10
</code></pre><h2 id="flatten" tabindex="-1"><a class="header-anchor" href="#flatten"><span>flatten</span></a></h2><p>Returns a buffer of 1 dimension</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#9D7CD8;font-style:italic;">var</span><span style="color:#C0CAF5;"> y</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">flatten</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">y</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">7</span><span style="color:#9ABDF5;">])</span></span>
<span class="line"></span></code></pre></div><pre><code>10
</code></pre><h2 id="get-nd-index" tabindex="-1"><a class="header-anchor" href="#get-nd-index"><span>get_nd_index</span></a></h2><p>Get the N-Dimensional Index needed to access the nth item</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get_nd_index</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">5</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><pre><code>(1, 0, 1)
</code></pre><h2 id="get-rank" tabindex="-1"><a class="header-anchor" href="#get-rank"><span>get_rank</span></a></h2><p>The total amount of dimensions</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get_rank</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>3
</code></pre><h2 id="get-shape" tabindex="-1"><a class="header-anchor" href="#get-shape"><span>get_shape</span></a></h2><p>A tuple indicating dimensions of the buffer.</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get_shape</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>(2, 2, 2)
</code></pre><h2 id="num-elements" tabindex="-1"><a class="header-anchor" href="#num-elements"><span>num_elements</span></a></h2><p>Calculates the total number of elements in the buffer, works the same as <code>size</code></p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">num_elements</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>8
</code></pre><h2 id="size" tabindex="-1"><a class="header-anchor" href="#size"><span>size</span></a></h2><p>Calculates the total number of elements in the buffer, works the same as <code>num_elements</code></p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">size</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>8
</code></pre><h2 id="stack-allocation" tabindex="-1"><a class="header-anchor" href="#stack-allocation"><span>stack_allocation</span></a></h2><p>Return a new NDBuffer that is backed by stack allocated data, aligned to the DType</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#9D7CD8;font-style:italic;">let</span><span style="color:#C0CAF5;"> new</span><span style="color:#89DDFF;"> =</span><span style="color:#A9B1D6;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">stack_allocation</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">new</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">size</span><span style="color:#9ABDF5;">())</span></span>
<span class="line"></span></code></pre></div><pre><code>8
</code></pre><h2 id="stride" tabindex="-1"><a class="header-anchor" href="#stride"><span>stride</span></a></h2><p>The step size of a dimension, e.g. in a <code>2x2x2</code> tensor if you increment the first dimension, you&#39;ll skip over 4 elements:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">stride</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">0</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><pre><code>4
</code></pre><p>Lets prove this by seeing how we could access the 4th element:</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">get_nd_index</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">4</span><span style="color:#9ABDF5;">))</span></span>
<span class="line"></span></code></pre></div><pre><code>(1, 0, 0)
</code></pre><h2 id="zero" tabindex="-1"><a class="header-anchor" href="#zero"><span>zero</span></a></h2><p>Set all elements to the zero value</p><div class="language-mojo" data-ext="mojo" data-title="mojo"><pre class="shiki tokyo-night" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#A9B1D6;">x</span><span style="color:#89DDFF;">.</span><span style="color:#A9B1D6;">buffer</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">zero</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#0DB9D7;">print</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">x</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">get</span><span style="color:#9ABDF5;">[</span><span style="color:#FF9E64;">0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#89DDFF;">,</span><span style="color:#FF9E64;"> 0</span><span style="color:#9ABDF5;">]())</span></span>
<span class="line"></span></code></pre></div><pre><code>0
</code></pre><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="external-link label" href="https://github.com/modularml/mojodojo.dev/edit/main/guides/std/Buffer/NDBuffer.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--[--><svg class="icon" viewBox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--> Edit this page on GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-P3E1jSxo.js" defer></script>
  </body>
</html>
